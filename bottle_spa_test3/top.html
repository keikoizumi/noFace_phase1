<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>noFace</title>
<script src="https://code.jquery.com/jquery-3.3.1.js"></script>
<script type="text/javascript">
//グローバル変数
var items = [];
//上限回数       
var setTimes = 100;
//チェック関数
function checkId(data){
         var id = '';
         id = data.id;
         //見つからない場合は-1
         if (items.indexOf(id) == -1){
            if (checkTimes(items)) {
              items.push(id);    
              addTags(data);
              console.log('通信成功');
              console.log(data);
              console.log('items');
              console.log(items);
              console.log('-------------------------------------------------------------');
            }
         } else { 
          　if (checkTimes(items)) {
              items.push('NG');
              getUrl();
            } else {
              items.push('NG');
            } 
         }  
}

function addTags(data){
  $(function() {
    $('ul').append('<li><a href='+data.url+'>'+data.url+'</a></li>');
  });
}

function checkTimes(items){
    if (items.length >= (setTimes)){
        alert('上限回数を超えました。リロードされます。');
        window.location.reload();
        return false;
    } else {
        return true;
    }   
}

function getUrl(){
  $(function(){
  
    var targetUrl = 'http://localhost:8080/spa'
    var request = {
        'ranNo' : null
    };
    
      $.ajax({
          url: targetUrl,
          type: 'POST',
          contentType: 'application/JSON',
          dataType: 'JSON',
          data : JSON.stringify(request),
          scriptCharset: 'utf-8',
      }).done(function(data){ 
          /* 通信成功時 */
          checkId(data);         
        }).fail(function(data, XMLHttpRequest, textStatus){
          /* 通信失敗時 */
          alert('通信失敗');
          console.log('通信失敗');
          console.log(data);
          console.log("XMLHttpRequest : " + XMLHttpRequest.status);
          console.log("textStatus     : " + textStatus);
      });
  });
}

$(function(){
  $('.sample_btn').on('click',function(){
    getUrl();
  });
});
</script>
</head>
<body>
  <input type="button" class="sample_btn" value="noFace"/>  	
  <ul>
  </ul>
</body>
</html>